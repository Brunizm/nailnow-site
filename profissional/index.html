<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Portal para profissionais NailNow acessarem oportunidades, acompanharem agendamentos e descobrirem os benefícios de fazer parte da rede."
    />
    <title>Portal da Profissional | NailNow</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles.css" />
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBHVZ9M6btJemXCIG-g5dG0xWq_jy50H7o",
        authDomain: "nailnow-site.firebaseapp.com",
        projectId: "nailnow-site",
        storageBucket: "nailnow-site.appspot.com",
        messagingSenderId: "726392294571",
        appId: "1:726392294571:web:a363a40231f7ac162e7bee",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const form = document.getElementById("login-form");
      const feedback = document.getElementById("login-feedback");
      const submitButton = form.querySelector("button[type='submit']");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const email = form.email.value.trim().toLowerCase();
        const senha = form.senha.value;

        feedback.textContent = "";
        feedback.style.color = "inherit";
        submitButton.disabled = true;
        submitButton.textContent = "Entrando…";

        try {
          const { user } = await signInWithEmailAndPassword(auth, email, senha);
          const perfilRef = doc(db, "manicures", user.uid);
          const perfilSnap = await getDoc(perfilRef);

          if (perfilSnap.exists()) {
            const dados = perfilSnap.data();
            const nome = dados.nome || dados.nomeCompleto || user.email;
            feedback.textContent = `✅ Olá, ${nome}! Login realizado com sucesso.`;
            feedback.style.color = "#2e7d32";
          } else {
            feedback.textContent = "⚠️ Login realizado, mas não encontramos seu cadastro de manicure. Entre em contato com o suporte.";
            feedback.style.color = "#ed6c02";
          }

          form.reset();
        } catch (error) {
          console.error("Erro ao entrar como manicure", error);
          feedback.textContent = `❌ ${traduzirErroAuth(error)}`;
          feedback.style.color = "#c62828";
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = "Entrar";
        }
      });

      function traduzirErroAuth(error) {
        const codigo = error?.code || "erro-desconhecido";
        switch (codigo) {
          case "auth/invalid-email":
            return "E-mail inválido. Confira o endereço digitado.";
          case "auth/user-disabled":
            return "Conta desativada. Fale com o suporte da NailNow.";
          case "auth/user-not-found":
            return "Nenhuma manicure encontrada com esse e-mail.";
          case "auth/wrong-password":
            return "Senha incorreta. Tente novamente.";
          case "auth/too-many-requests":
            return "Muitas tentativas. Aguarde alguns instantes e tente de novo.";
          default:
            return "Não foi possível fazer login. Tente novamente em instantes.";
        }
      }

      loginForm?.addEventListener("submit", handleLogin);
      refreshButton?.addEventListener("click", () => {
        if (currentUser && !isLoadingAppointments) {
          refreshButton.disabled = true;
          setPortalStatus("Atualizando solicitações…", { loading: true });
          hydratePortal(currentUser, { silent: true }).finally(() => {
            refreshButton.disabled = false;
          });
        }
      });
      logoutButton?.addEventListener("click", handleLogout);

      onAuthStateChanged(auth, (user) => {
        currentUser = user;
        if (user) {
          togglePortal(true);
          hydratePortal(user);
        } else {
          togglePortal(false);
        }
      });
    </script>
  </head>
  <body class="professional-page">
    <header class="site-header">
      <div class="header-inner">
        <a href="/" class="brand-mark" aria-label="Início da NailNow">NailNow</a>
        <div class="header-navigation">
          <nav class="primary-nav" aria-label="Principal">
            <a href="/" class="nav-link">Home</a>
            <a href="../como-funciona.html" class="nav-link">Como funciona</a>
            <a href="../servicos.html" class="nav-link">Serviços</a>
            <a href="../agendamentos.html" class="nav-link">Agendamentos</a>
          </nav>
          <div class="header-actions">
            <a href="../cliente/index.html" class="header-cta">Sou Cliente</a>
            <a href="../profissional/index.html" class="header-cta" aria-current="page"
              >Sou Profissional</a
            >
            <a
              class="social-link social-link--instagram"
              href="https://www.instagram.com/nailnowbr/"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Instagram da NailNow"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M7 3C4.24 3 2 5.24 2 8v8c0 2.76 2.24 5 5 5h10c2.76 0 5-2.24 5-5V8c0-2.76-2.24-5-5-5H7zm10 2a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3h10zm-5 3.5A4.5 4.5 0 1 0 16.5 13 4.5 4.5 0 0 0 12 8.5zm0 2A2.5 2.5 0 1 1 9.5 13 2.5 2.5 0 0 1 12 10.5zm4.75-4.75a1 1 0 1 0 1 1 1 1 0 0 0-1-1z"
                />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </header>

    <main class="page-content">
      <img
        src="https://images.unsplash.com/photo-1522336572468-97b06e8ef143?auto=format&fit=crop&w=800&q=80"
        alt="Profissional cuidando das unhas"
        class="page-img"
        loading="lazy"
        width="500"
        height="333"
      />
      <h1>Área da Profissional</h1>
      <form id="login-form">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" autocomplete="email" required />
        <label for="senha">Senha</label>
        <input type="password" id="senha" name="senha" autocomplete="current-password" required />
        <button type="submit" class="btn">Entrar</button>
      </form>
      <p id="login-feedback" class="form-feedback" role="status" aria-live="polite"></p>
      <p>Primeira vez por aqui?</p>
      <a href="cadastro.html" class="btn">Cadastrar</a>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <div class="footer-column footer-column--brand">
          <h2 class="footer-logo">NailNow</h2>
          <p>
            Beleza na sua agenda com profissionais selecionadas, atendimento onde você estiver e
            suporte humanizado.
          </p>
        </div>
        <div class="footer-column footer-links" aria-label="Links úteis">
          <h3>FAQ</h3>
          <a href="../faq.html">Perguntas frequentes</a>
          <a href="../como-funciona.html">Como funciona</a>
          <a href="../agendamentos.html">Agendamentos</a>
        </div>
        <div class="footer-column footer-links" aria-label="Contato e suporte">
          <h3>Contato &amp; suporte</h3>
          <a href="mailto:contato@nailnow.com">contato@nailnow.com</a>
        </div>
        <div class="footer-column footer-links" aria-label="Termos e políticas">
          <h3>Termos &amp; políticas</h3>
          <a href="#">Termos de uso</a>
          <a href="#">Política de privacidade</a>
          <a href="#">Cookies e preferências</a>
        </div>
      </div>
      <p class="footer-copy">© NailNow 2025. Todos os direitos reservados.</p>
    </footer>

    <nav class="bottom-nav" aria-label="Navegação inferior fixa">
      <a href="/" class="bottom-nav__link">Home</a>
      <a href="../servicos.html" class="bottom-nav__link">Buscar</a>
      <a href="../cliente/index.html" class="bottom-nav__link">Agendamentos</a>
      <a href="../cliente/" class="bottom-nav__link">Perfil</a>
    </nav>
  </body>
</html>
