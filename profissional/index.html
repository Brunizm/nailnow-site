<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Portal para profissionais NailNow acessarem oportunidades, acompanharem agendamentos e descobrirem os benefícios de fazer parte da rede."
    />
    <title>Portal da Profissional | NailNow</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles.css" />

    <style>
      /* NailNow — Componentes reutilizáveis */
      .pill {
        padding: 8px 12px;
        border-radius: 999px;
        background: #fff;
        border: 1px solid #f1e6e1;
        font-size: 13px;
        color: #6b544c;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .pill.pink {
        background: #fff2f9;
        border-color: #f6d3e8;
        color: #c61b80;
      }
      .badge {
        background: #fff;
        border: 1px solid #f1e6e1;
        border-radius: 999px;
        padding: 6px 10px;
        font-size: 12px;
        color: #7a5b52;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .card {
        background: var(--white);
        border: 1px solid #f1e6e1;
        border-radius: var(--radius, 16px);
        padding: 16px;
        box-shadow: none;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      .card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow, 0 8px 28px rgba(0, 0, 0, 0.06));
      }
      .card-row {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 14px;
        align-items: center;
      }
      .avatar,
      .avatar-md,
      .avatar-xl {
        border-radius: 50%;
        background: #ffe1f2;
        overflow: hidden;
      }
      .avatar {
        width: 44px;
        height: 44px;
      }
      .avatar-md {
        width: 64px;
        height: 64px;
      }
      .avatar-xl {
        width: 104px;
        height: 104px;
      }
      .stars {
        color: #e08dbe;
        font-size: 14px;
        letter-spacing: 1px;
      }
      .rating {
        color: #e08dbe;
        font-weight: 700;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }
      .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }
      .grid-4 {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }
      @media (max-width: 980px) {
        .grid-3 {
          grid-template-columns: 1fr 1fr;
        }
        .grid-4 {
          grid-template-columns: 1fr 1fr;
        }
      }
      @media (max-width: 620px) {
        .grid-2,
        .grid-3,
        .grid-4 {
          grid-template-columns: 1fr;
        }
      }
      .input,
      .select,
      .textarea {
        width: 100%;
        padding: 12px;
        border: 1.5px solid #eadbd5;
        border-radius: 12px;
        font: inherit;
      }
      .input:focus,
      .select:focus,
      .textarea:focus {
        outline: none;
        border-color: var(--pink, #f673af);
        box-shadow: 0 0 0 3px #ffe1f2;
      }
      .label {
        font-size: 12px;
        color: #6b544c;
        display: block;
        margin-bottom: 6px;
      }
      .show-mobile {
        display: none;
      }
      @media (max-width: 840px) {
        .show-mobile {
          display: block !important;
        }
      }

      :root {
        --pink: #f673af;
        --pink-600: #c61b80;
        --pink-50: #fff1f6;
        --rose-50: #fff8f4;
        --nude: #fff8f4;
        --brown: #74260a;
        --text: #2b1f1a;
        --white: #ffffff;
        --radius: 16px;
        --shadow: 0 8px 28px rgba(0, 0, 0, 0.06);
        --shadow-soft: 0 8px 14px rgba(0, 0, 0, 0.05);
        --container: 1160px;
      }
      body.professional-page {
        font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica,
          Arial, sans-serif;
        color: var(--text);
        background: var(--white);
        line-height: 1.6;
      }
      .container {
        width: 100%;
        max-width: var(--container);
        margin: 0 auto;
        padding: 0 20px;
      }
      .grid {
        display: grid;
        gap: 24px;
      }
      .btn-modern {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 14px 20px;
        border-radius: 12px;
        border: 2px solid transparent;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: transform 0.15s ease, box-shadow 0.15s ease, background-color 0.2s ease,
          color 0.2s ease;
        font-size: 16px;
      }
      .btn-modern:active {
        transform: translateY(1px);
      }
      .btn-pink {
        background: var(--pink);
        color: var(--white);
        box-shadow: var(--shadow-soft);
      }
      .btn-pink:hover {
        filter: brightness(0.97);
      }
      .btn-outline {
        background: var(--white);
        color: var(--pink);
        border-color: var(--pink);
        border-style: solid;
      }
      .btn-outline:hover {
        background: #fff2f9;
      }
      .btn-white {
        background: var(--white);
        color: var(--pink-600);
      }
      h1,
      h2,
      h3 {
        font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica,
          Arial, sans-serif;
        color: #1e1512;
        line-height: 1.2;
        font-weight: 700;
      }
      h1 {
        font-size: clamp(30px, 5vw, 44px);
        margin: 0 0 12px;
        letter-spacing: -0.02em;
      }
      h2 {
        font-size: clamp(22px, 4vw, 32px);
        margin: 0 0 10px;
        letter-spacing: -0.01em;
      }
      h3 {
        font-size: clamp(18px, 3vw, 22px);
        margin: 0 0 8px;
        font-weight: 700;
      }
      p.lead {
        font-size: clamp(16px, 2.4vw, 18px);
        color: #5a453e;
        max-width: 56ch;
      }
      .chip {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        background: var(--nude);
        color: #7a5b52;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.2px;
      }
      .hero-section {
        background: linear-gradient(180deg, var(--pink-50), var(--rose-50));
        padding: 72px 0 56px;
      }
      .grid-hero {
        grid-template-columns: 1.1fr 0.9fr;
        align-items: center;
      }
      .hero-media {
        min-height: 280px;
        border-radius: var(--radius);
        background: url('https://images.unsplash.com/photo-1604654894611-1e6233581a30?auto=format&fit=crop&w=1200&q=80')
          center/cover no-repeat;
        box-shadow: var(--shadow);
      }
      .hero-cta {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 18px;
      }
      .card-login {
        background: var(--white);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 24px;
      }
      .is-hidden {
        display: none !important;
      }
      .card-login.is-hidden {
        display: none;
      }
      .card-login h3 {
        font-size: 18px;
        margin: 0 0 12px;
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 12px;
      }
      .field label {
        font-size: 12px;
        color: #6b544c;
      }
      .field input {
        padding: 12px;
        border: 1.5px solid #eadbd5;
        border-radius: 12px;
        outline: none;
        font-size: 14px;
      }
      .field input:focus {
        border-color: var(--pink);
        box-shadow: 0 0 0 3px #ffe1f2;
      }
      .login-feedback {
        margin-top: 8px;
        font-size: 13px;
        color: #7d6a63;
      }
      .login-feedback.error {
        color: #c62828;
      }
      .login-feedback.success {
        color: #2e7d32;
      }
      .muted {
        color: #7d6a63;
        font-size: 12px;
      }
      @media (max-width: 980px) {
        .grid-hero {
          grid-template-columns: 1fr;
        }
        .hero-media {
          min-height: 220px;
        }
      }
      section.beneficios {
        padding: 64px 0;
      }
      .cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }
      .cards .card {
        padding: 22px;
      }
      .icon {
        width: 44px;
        height: 44px;
        display: grid;
        place-items: center;
        border-radius: 12px;
        background: #fff2f9;
        color: var(--pink-600);
        font-size: 20px;
        border: 1px solid #f6d3e8;
      }
      .cards .card p {
        margin: 8px 0 0;
        color: #5a453e;
        font-size: 14px;
      }
      @media (max-width: 980px) {
        .cards {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 620px) {
        .cards {
          grid-template-columns: 1fr;
        }
      }
      section.flow {
        padding: 80px 0;
        background: var(--nude);
      }
      .portal {
        display: none;
        padding: 72px 0;
        background: #fff;
      }
      .portal.is-active {
        display: block;
      }
      .portal-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 24px;
        flex-wrap: wrap;
      }
      .portal-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .portal-meta {
        margin-top: 8px;
        font-size: 13px;
        color: #7a5b52;
      }
      .portal-status {
        margin-top: 32px;
        border-radius: 20px;
        padding: 18px;
        background: #fff7fb;
        color: #6b544c;
        display: none;
        align-items: center;
        gap: 12px;
        border: 1px solid #f6d3e8;
      }
      .portal-status.is-visible {
        display: flex;
      }
      .portal-status.is-error {
        background: #ffe4e6;
        border-color: #ffccd5;
        color: #b71c1c;
      }
      .portal-status.is-success {
        background: #ecf8ee;
        border-color: #c8e6c9;
        color: #1b5e20;
      }
      .portal-status .spinner {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid rgba(198, 27, 128, 0.2);
        border-top-color: rgba(198, 27, 128, 0.8);
        animation: spin 0.9s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .summary-grid {
        margin-top: 32px;
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
      .summary-card {
        background: var(--white);
        border: 1px solid #f1e6e1;
        border-radius: 18px;
        padding: 18px;
        box-shadow: var(--shadow-soft);
      }
      .summary-card span {
        display: block;
        font-size: 13px;
        color: #7a5b52;
      }
      .summary-card strong {
        display: block;
        margin-top: 6px;
        font-size: 24px;
        color: #3b2a24;
      }
      .requests-wrapper {
        margin-top: 40px;
      }
      .requests-list {
        display: grid;
        gap: 16px;
      }
      .request-card {
        background: var(--white);
        border-radius: 20px;
        border: 1px solid #f1e6e1;
        padding: 20px;
        box-shadow: var(--shadow-soft);
      }
      .request-card header {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }
      .request-card h3 {
        margin: 0;
        font-size: 18px;
      }
      .status-pill {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.3px;
        background: #fff2f9;
        color: var(--pink-600);
        border: 1px solid #f6d3e8;
      }
      .status-pill[data-tone='confirmado'] {
        background: #ecf8ee;
        border-color: #c8e6c9;
        color: #1b5e20;
      }
      .status-pill[data-tone='concluido'] {
        background: #e3f2fd;
        border-color: #bbdefb;
        color: #0d47a1;
      }
      .status-pill[data-tone='cancelado'] {
        background: #ffebee;
        border-color: #ffcdd2;
        color: #c62828;
      }
      .status-pill[data-tone='pendente'] {
        background: #fff7e6;
        border-color: #ffe0b2;
        color: #e65100;
      }
      .status-pill[data-tone='em andamento'] {
        background: #f3e8ff;
        border-color: #d0bcff;
        color: #5a189a;
      }
      .request-details {
        display: grid;
        gap: 12px;
      }
      .request-details dl {
        margin: 0;
        display: grid;
        grid-template-columns: minmax(120px, 1fr) 2fr;
        gap: 4px 12px;
        font-size: 14px;
        color: #5a453e;
      }
      .request-details dt {
        font-weight: 600;
        color: #4a342d;
      }
      .request-empty {
        margin-top: 28px;
        padding: 28px;
        text-align: center;
        border-radius: 20px;
        background: var(--nude);
        border: 1px dashed #f6d3e8;
        color: #6b544c;
        font-size: 15px;
      }
      .request-meta {
        margin-top: 12px;
        font-size: 12px;
        color: #8a756d;
      }
      .badge-soft {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: #fff2f9;
        color: var(--pink-600);
        font-size: 12px;
        font-weight: 600;
      }
      .request-actions {
        margin-top: 16px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .request-actions a {
        font-size: 13px;
        font-weight: 600;
        color: var(--pink-600);
        text-decoration: none;
      }
      @media (max-width: 840px) {
        .portal-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .portal-actions {
          width: 100%;
        }
        .portal-actions .btn-modern {
          flex: 1 1 auto;
        }
      }
      @media (max-width: 620px) {
        .request-details dl {
          grid-template-columns: 1fr;
        }
      }
      .flow-visual {
        display: flex;
        align-items: stretch;
        justify-content: center;
        gap: 24px;
        margin-top: 32px;
        flex-wrap: wrap;
      }
      .flow-step {
        flex: 1 1 220px;
        max-width: 260px;
        background: var(--white);
        border-radius: 24px;
        border: 1px solid #f1e6e1;
        padding: 24px 20px;
        text-align: center;
        box-shadow: var(--shadow-soft);
      }
      .flow-step img {
        width: 96px;
        height: 96px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #ffe1f2;
        margin-bottom: 16px;
      }
      .flow-step h3 {
        font-size: 18px;
        margin: 0 0 8px;
      }
      .flow-step p {
        margin: 0;
        font-size: 14px;
        color: #5a453e;
      }
      .flow-arrow {
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: var(--pink-600);
      }
      @media (max-width: 980px) {
        .flow-visual {
          justify-content: flex-start;
        }
      }
      @media (max-width: 720px) {
        .flow-visual {
          flex-direction: column;
          align-items: center;
        }
        .flow-arrow {
          display: none;
        }
        .flow-step {
          max-width: 320px;
        }
      }
      section.deps {
        padding: 64px 0;
      }
      .dep-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }
      .dep {
        background: var(--white);
        border: 1px solid #f1e6e1;
        border-radius: var(--radius);
        padding: 20px;
      }
      .person {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 10px;
      }
      .dep p {
        margin: 0;
        font-size: 14px;
        color: #4d3b35;
      }
      @media (max-width: 980px) {
        .dep-row {
          grid-template-columns: 1fr;
        }
      }
      section.trust {
        padding: 72px 0;
        background: var(--rose-50);
      }
      .trust-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }
      .trust-item {
        background: var(--white);
        border: 1px solid #f1e6e1;
        border-radius: var(--radius);
        padding: 20px;
      }
      .trust-item h4 {
        margin: 0 0 6px;
        font-size: 16px;
      }
      .trust-item p {
        margin: 0;
        font-size: 14px;
        color: #5a453e;
      }
      @media (max-width: 980px) {
        .trust-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signInWithEmailAndPassword,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import {
        getFirestore,
        collection,
        doc,
        getDoc,
        getDocs,
        query,
        where,
        limit,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBHVZ9M6btJemXCIG-g5dG0xWq_jy50H7o",
        authDomain: "nailnow-site.firebaseapp.com",
        projectId: "nailnow-site",
        storageBucket: "nailnow-site.appspot.com",
        messagingSenderId: "726392294571",
        appId: "1:726392294571:web:a363a40231f7ac162e7bee",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const loginForm = document.getElementById("login-form");
      const loginCard = document.getElementById("login-card");
      const loginButton = document.getElementById("login-submit");
      const loginFeedback = document.getElementById("login-feedback");
      const portalSection = document.getElementById("professional-portal");
      const portalGreeting = document.getElementById("portal-greeting");
      const portalSubhead = document.getElementById("portal-subhead");
      const portalMeta = document.getElementById("portal-meta");
      const portalStatus = document.getElementById("portal-status");
      const summaryGrid = document.getElementById("request-summary");
      const requestList = document.getElementById("requests-list");
      const emptyState = document.getElementById("requests-empty");
      const refreshButton = document.getElementById("refresh-requests");
      const logoutButton = document.getElementById("logout-button");

      let currentUser = null;
      let isLoadingAppointments = false;

      const COLLECTION_CANDIDATES = [
        { name: "agendamentos", label: "agendamentos" },
        { name: "solicitacoes", label: "solicitações" },
        { name: "pedidos", label: "pedidos" },
        { name: "requests", label: "requests" },
      ];

      const PROFESSIONAL_FIELD_CANDIDATES = [
        "profissionalId",
        "profissionalUID",
        "profissionalUid",
        "uidProfissional",
        "professionalId",
        "manicureId",
        "manicureUid",
      ];

      function setLoginFeedback(message, tone = "") {
        if (!loginFeedback) return;
        loginFeedback.textContent = message || "";
        loginFeedback.classList.remove("error", "success");
        if (tone) {
          loginFeedback.classList.add(tone);
        }
      }

      function togglePortal(isVisible) {
        if (isVisible) {
          portalSection?.classList.add("is-active");
          loginCard?.classList.add("is-hidden");
        } else {
          portalSection?.classList.remove("is-active");
          loginCard?.classList.remove("is-hidden");
          resetPortal();
        }
      }

      function resetPortal() {
        setPortalStatus("");
        portalMeta && (portalMeta.textContent = "");
        if (summaryGrid) summaryGrid.innerHTML = "";
        if (requestList) requestList.innerHTML = "";
        emptyState?.classList.add("is-hidden");
      }

      function setPortalStatus(message, { tone = "info", loading = false } = {}) {
        if (!portalStatus) return;
        portalStatus.innerHTML = "";
        portalStatus.classList.remove("is-visible", "is-error", "is-success");
        if (!message && !loading) {
          return;
        }
        portalStatus.classList.add("is-visible");
        if (tone === "error") {
          portalStatus.classList.add("is-error");
        } else if (tone === "success") {
          portalStatus.classList.add("is-success");
        }
        if (loading) {
          const spinner = document.createElement("span");
          spinner.className = "spinner";
          spinner.setAttribute("aria-hidden", "true");
          portalStatus.appendChild(spinner);
        }
        const text = document.createElement("span");
        text.textContent = message;
        portalStatus.appendChild(text);
      }

      function extractFirstName(name) {
        if (!name) return "Profissional";
        const parts = name.trim().split(/\s+/);
        return parts[0] || name;
      }

      function normalizeUid(value) {
        if (!value) return "";
        return String(value).trim();
      }

      function normalizeStatus(value) {
        if (!value) return "pendente";
        const raw = String(value).toLowerCase();
        if (raw.includes("confirm") || raw.includes("aceit")) return "confirmado";
        if (raw.includes("concl") || raw.includes("final")) return "concluido";
        if (raw.includes("cancel") || raw.includes("recus")) return "cancelado";
        if (raw.includes("andament") || raw.includes("progres")) return "em andamento";
        if (raw.includes("pend")) return "pendente";
        return raw;
      }

      function formatStatusLabel(status) {
        const map = {
          pendente: "Pendente",
          confirmado: "Confirmado",
          "em andamento": "Em andamento",
          concluido: "Concluído",
          cancelado: "Cancelado",
        };
        return map[status] || status.replace(/^(\w)/, (match) => match.toUpperCase());
      }

      function parseDateTime(value) {
        if (!value) return null;
        if (value instanceof Date) return value;
        if (typeof value === "number") {
          const date = new Date(value);
          return isNaN(date.getTime()) ? null : date;
        }
        if (typeof value === "string") {
          const normalized = value.replace(/T/, " ").trim();
          const direct = new Date(normalized);
          if (!isNaN(direct.getTime())) {
            return direct;
          }
          const match = normalized.match(
            /(\d{2})[\/-](\d{2})[\/-](\d{4})(?:[\sT](\d{2}):(\d{2})(?::(\d{2}))?)?/
          );
          if (match) {
            const [, day, month, year, hours = "00", minutes = "00", seconds = "00"] = match;
            const iso = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
            const parsed = new Date(iso);
            if (!isNaN(parsed.getTime())) {
              return parsed;
            }
          }
          return null;
        }
        if (typeof value === "object") {
          if (typeof value.seconds === "number") {
            const ms = value.seconds * 1000 + (value.nanoseconds || 0) / 1e6;
            const date = new Date(ms);
            return isNaN(date.getTime()) ? null : date;
          }
          if (value.toDate instanceof Function) {
            const date = value.toDate();
            return isNaN(date.getTime()) ? null : date;
          }
        }
        return null;
      }

      function formatDateTime(value) {
        const date = parseDateTime(value);
        if (!date) return null;
        return date.toLocaleString("pt-BR", {
          dateStyle: "short",
          timeStyle: "short",
        });
      }

      function normalizeServices(value) {
        if (!value) return [];
        if (Array.isArray(value)) {
          return value
            .map((item) => (item ? String(item).trim() : ""))
            .filter(Boolean);
        }
        return String(value)
          .split(/[,;\n]/)
          .map((item) => item.trim())
          .filter(Boolean);
      }

      function formatCurrency(value) {
        if (value == null || value === "") return null;
        const numeric = typeof value === "string" ? Number(value.replace(/[^0-9,-]/g, "").replace(",", ".")) : Number(value);
        if (!isFinite(numeric)) return null;
        return numeric.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
      }

      function normalizePhone(value) {
        if (!value) return null;
        const digits = String(value).replace(/\D/g, "");
        return digits || null;
      }

      function formatPhoneLabel(digits) {
        if (!digits) return null;
        if (digits.length === 11) {
          return `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7)}`;
        }
        if (digits.length === 10) {
          return `(${digits.slice(0, 2)}) ${digits.slice(2, 6)}-${digits.slice(6)}`;
        }
        return digits;
      }

      function normalizeAppointment(docSnap) {
        const data = docSnap.data() || {};
        const services = Array.from(
          new Set(
            normalizeServices(
              data.servicos || data.servicosOferecidos || data.services || data.servico || data.servicoDesejado
            )
          )
        );
        const status = normalizeStatus(data.status || data.situacao || data.state || data.etapa);
        const requestedAt =
          data.dataHora ||
          data.horario ||
          data.dataAtendimento ||
          data.dataAgendada ||
          data.data ||
          data.agendamento?.inicio ||
          data.inicio ||
          data.startAt;
        const createdAtValue =
          data.criadoEm ||
          data.createdAt ||
          data.solicitadoEm ||
          data.dataSolicitacao ||
          data.timestamp ||
          data.created_on;

        const rawPrice = data.valor || data.preco || data.total || data.price;
        const formattedPrice = formatCurrency(rawPrice);

        const notesRaw = data.observacoes ?? data.notas ?? data.notes ?? "";
        const notes = Array.isArray(notesRaw)
          ? notesRaw.map((item) => (item ? String(item).trim() : "")).filter(Boolean).join("; ")
          : typeof notesRaw === "string"
          ? notesRaw.trim()
          : "";

        return {
          id: docSnap.id,
          status,
          rawStatus: data.status || data.situacao || data.state || data.etapa || "",
          services,
          clientName:
            data.clienteNome ||
            data.nomeCliente ||
            data.cliente?.nome ||
            data.clientName ||
            data.cliente ||
            "Cliente NailNow",
          address:
            data.enderecoAtendimento ||
            data.endereco ||
            data.local?.descricao ||
            data.local?.endereco ||
            data.address ||
            data.location ||
            "",
          price: formattedPrice || (rawPrice ? String(rawPrice) : ""),
          phone: normalizePhone(
            data.telefoneCliente ||
              data.telefone ||
              data.celular ||
              data.clientPhone ||
              data.contatoCliente ||
              data.whatsapp
          ),
          notes,
          time: parseDateTime(requestedAt),
          createdAt: parseDateTime(createdAtValue),
          raw: data,
        };
      }

      function createSummaryCard(label, value) {
        const card = document.createElement("div");
        card.className = "summary-card";
        const span = document.createElement("span");
        span.textContent = label;
        const strong = document.createElement("strong");
        strong.textContent = value;
        card.append(span, strong);
        return card;
      }

      function renderSummary(appointments) {
        if (!summaryGrid) return;
        summaryGrid.innerHTML = "";
        const totalCard = createSummaryCard("Solicitações", appointments.length);
        summaryGrid.appendChild(totalCard);

        const counts = appointments.reduce((acc, appointment) => {
          const key = appointment.status;
          acc[key] = (acc[key] || 0) + 1;
          return acc;
        }, {});

        ["pendente", "confirmado", "em andamento", "concluido", "cancelado"].forEach((status) => {
          if (counts[status]) {
            summaryGrid.appendChild(createSummaryCard(formatStatusLabel(status), counts[status]));
          }
        });
      }

      function appendDetail(dl, label, value) {
        if (!value) return;
        const dt = document.createElement("dt");
        dt.textContent = label;
        const dd = document.createElement("dd");
        dd.textContent = value;
        dl.append(dt, dd);
      }

      function renderAppointments(appointments, sourceLabel) {
        if (portalMeta) {
          portalMeta.textContent = sourceLabel ? `Origem dos dados: coleção “${sourceLabel}”.` : "";
        }

        if (!requestList) return;
        requestList.innerHTML = "";

        const sorted = [...appointments].sort((a, b) => {
          const aTime = a.time?.getTime() ?? a.createdAt?.getTime() ?? Number.POSITIVE_INFINITY;
          const bTime = b.time?.getTime() ?? b.createdAt?.getTime() ?? Number.POSITIVE_INFINITY;
          if (aTime === bTime) {
            return (a.clientName || "").localeCompare(b.clientName || "");
          }
          return aTime - bTime;
        });

        if (!sorted.length) {
          emptyState?.classList.remove("is-hidden");
          renderSummary(sorted);
          return;
        }

        emptyState?.classList.add("is-hidden");
        renderSummary(sorted);

        sorted.forEach((appointment) => {
          const card = document.createElement("article");
          card.className = "request-card";

          const header = document.createElement("header");
          const title = document.createElement("h3");
          title.textContent = appointment.clientName;
          const statusPill = document.createElement("span");
          statusPill.className = "status-pill";
          statusPill.dataset.tone = appointment.status;
          statusPill.textContent = formatStatusLabel(appointment.status);
          header.append(title, statusPill);
          card.appendChild(header);

          const detailsWrapper = document.createElement("div");
          detailsWrapper.className = "request-details";
          const dl = document.createElement("dl");
          appendDetail(dl, "Data e horário", formatDateTime(appointment.time) || "A definir");
          if (appointment.services.length) {
            appendDetail(dl, "Serviços", appointment.services.join(", "));
          }
          appendDetail(dl, "Local", appointment.address);
          appendDetail(dl, "Valor", appointment.price);
          if (appointment.phone) {
            appendDetail(dl, "Contato", formatPhoneLabel(appointment.phone));
          }
          if (appointment.notes) {
            appendDetail(dl, "Observações", appointment.notes);
          }
          detailsWrapper.appendChild(dl);
          card.appendChild(detailsWrapper);

          if (appointment.createdAt) {
            const meta = document.createElement("div");
            meta.className = "request-meta";
            meta.textContent = `Solicitação recebida em ${formatDateTime(appointment.createdAt)}.`;
            card.appendChild(meta);
          }

          if (appointment.phone) {
            const actions = document.createElement("div");
            actions.className = "request-actions";
            const whatsappLink = document.createElement("a");
            whatsappLink.href = `https://wa.me/55${appointment.phone}`;
            whatsappLink.target = "_blank";
            whatsappLink.rel = "noopener";
            whatsappLink.textContent = "Chamar no WhatsApp";
            actions.appendChild(whatsappLink);
            const callLink = document.createElement("a");
            callLink.href = `tel:${appointment.phone}`;
            callLink.textContent = "Ligar";
            actions.appendChild(callLink);
            card.appendChild(actions);
          }

          requestList.appendChild(card);
        });
      }

      async function fetchAppointments(uid) {
        for (const candidate of COLLECTION_CANDIDATES) {
          const collectionRef = collection(db, candidate.name);
          for (const field of PROFESSIONAL_FIELD_CANDIDATES) {
            try {
              const snapshot = await getDocs(query(collectionRef, where(field, "==", uid), limit(50)));
              if (!snapshot.empty) {
                return {
                  appointments: snapshot.docs.map(normalizeAppointment),
                  source: candidate.label,
                };
              }
            } catch (error) {
              console.warn(`Falha ao consultar ${candidate.name} por ${field}`, error);
            }
          }

          try {
            const snapshot = await getDocs(query(collectionRef, limit(50)));
            const filtered = snapshot.docs.filter((docSnap) => {
              const data = docSnap.data() || {};
              return PROFESSIONAL_FIELD_CANDIDATES.some((field) => normalizeUid(data[field]) === uid);
            });
            if (filtered.length) {
              return {
                appointments: filtered.map(normalizeAppointment),
                source: candidate.label,
              };
            }
          } catch (error) {
            console.warn(`Falha ao carregar ${candidate.name}`, error);
          }
        }

        return { appointments: [], source: null };
      }

      async function loadProfile(uid, fallbackEmail) {
        try {
          const profileRef = doc(db, "profissionais", uid);
          const snapshot = await getDoc(profileRef);
          if (snapshot.exists()) {
            return snapshot.data();
          }
        } catch (error) {
          console.warn("Não foi possível buscar o perfil da profissional", error);
        }
        return { nome: fallbackEmail || "Profissional NailNow" };
      }

      async function hydratePortal(user, { silent = false } = {}) {
        if (!user) return;
        if (!silent) {
          setPortalStatus("Carregando suas solicitações…", { loading: true });
        }
        isLoadingAppointments = true;
        try {
          const profile = await loadProfile(user.uid, user.email || "");
          const firstName = extractFirstName(profile.nome || profile.name || user.displayName || user.email);
          if (portalGreeting) {
            portalGreeting.textContent = `Olá, ${firstName}!`;
          }
          if (portalSubhead) {
            const cidade = profile.cidade || profile.city || profile.localidade || "";
            portalSubhead.textContent = cidade
              ? `Veja os pedidos de agendamento na sua região (${cidade}) e confirme seu próximo atendimento.`
              : "Veja os pedidos de agendamento e confirme seu próximo atendimento.";
          }

          const { appointments, source } = await fetchAppointments(user.uid);
          renderAppointments(appointments, source);

          if (appointments.length) {
            setPortalStatus(
              `Encontramos ${appointments.length} solicitação${appointments.length > 1 ? "s" : ""} para você.`,
              { tone: "success" }
            );
          } else {
            setPortalStatus(
              "Ainda não há solicitações registradas para sua conta. Assim que uma cliente fizer um pedido, ele aparecerá aqui.",
              { tone: "info" }
            );
          }
        } catch (error) {
          console.error("Erro ao carregar portal da profissional", error);
          setPortalStatus(
            "Não foi possível carregar suas solicitações agora. Tente novamente em alguns instantes.",
            { tone: "error" }
          );
        } finally {
          isLoadingAppointments = false;
        }
      }

      async function handleLogin(event) {
        event.preventDefault();
        if (!loginForm || !loginButton) return;
        const formData = new FormData(loginForm);
        const email = String(formData.get("email") || "").trim();
        const password = String(formData.get("senha") || "").trim();
        if (!email || !password) {
          setLoginFeedback("Preencha e-mail e senha para continuar.", "error");
          return;
        }
        loginButton.disabled = true;
        loginButton.textContent = "Entrando…";
        setLoginFeedback("Autenticando…");
        try {
          await signInWithEmailAndPassword(auth, email, password);
          setLoginFeedback("Login realizado com sucesso!", "success");
          loginForm.reset();
        } catch (error) {
          console.error("Erro ao autenticar profissional", error);
          const message =
            error.code === "auth/wrong-password"
              ? "Senha incorreta. Tente novamente."
              : error.code === "auth/user-not-found"
              ? "Não encontramos uma conta com esse e-mail. Confira os dados informados."
              : "Não foi possível entrar agora. Verifique seus dados e tente novamente.";
          setLoginFeedback(message, "error");
        } finally {
          loginButton.disabled = false;
          loginButton.textContent = "Entrar na plataforma";
        }
      }

      async function handleLogout() {
        try {
          await signOut(auth);
          setLoginFeedback("Sessão encerrada com sucesso.", "success");
        } catch (error) {
          console.error("Erro ao encerrar sessão", error);
          setLoginFeedback("Não foi possível sair agora. Tente novamente.", "error");
        }
      }

      loginForm?.addEventListener("submit", handleLogin);
      refreshButton?.addEventListener("click", () => {
        if (currentUser && !isLoadingAppointments) {
          refreshButton.disabled = true;
          setPortalStatus("Atualizando solicitações…", { loading: true });
          hydratePortal(currentUser, { silent: true }).finally(() => {
            refreshButton.disabled = false;
          });
        }
      });
      logoutButton?.addEventListener("click", handleLogout);

      onAuthStateChanged(auth, (user) => {
        currentUser = user;
        if (user) {
          togglePortal(true);
          hydratePortal(user);
        } else {
          togglePortal(false);
        }
      });
    </script>
  </head>
  <body class="professional-page">
    <header class="site-header">
      <div class="header-inner">
        <a href="/" class="brand-mark" aria-label="Início da NailNow">NailNow</a>
        <div class="header-navigation">
          <nav class="primary-nav" aria-label="Principal">
            <a href="/" class="nav-link">Home</a>
            <a href="../como-funciona.html" class="nav-link">Como funciona</a>
            <a href="../servicos.html" class="nav-link">Serviços</a>
            <a href="../agendamentos.html" class="nav-link">Agendamentos</a>
          </nav>
          <div class="header-actions">
            <a href="../cliente/index.html" class="header-cta">Sou Cliente</a>
            <a href="../profissional/index.html" class="header-cta" aria-current="page"
              >Sou Profissional</a
            >
            <a
              class="social-link social-link--instagram"
              href="https://www.instagram.com/nailnowbr/"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Instagram da NailNow"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M7 3C4.24 3 2 5.24 2 8v8c0 2.76 2.24 5 5 5h10c2.76 0 5-2.24 5-5V8c0-2.76-2.24-5-5-5H7zm10 2a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3h10zm-5 3.5A4.5 4.5 0 1 0 16.5 13 4.5 4.5 0 0 0 12 8.5zm0 2A2.5 2.5 0 1 1 9.5 13 2.5 2.5 0 0 1 12 10.5zm4.75-4.75a1 1 0 1 0 1 1 1 1 0 0 0-1-1z"
                />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="hero-section">
        <div class="container">
          <div class="grid grid-hero">
            <div>
              <span class="chip">Portal da profissional</span>
              <h1>Seu talento merece visibilidade.</h1>
              <p class="lead">
                Com a NailNow, você tem autonomia, segurança e uma rede inteira de clientes ao seu
                alcance. Faça parte do movimento beauty-on-demand.
              </p>
              <div class="hero-cta">
                <a href="cadastro.html" class="btn-modern btn-outline">Quero fazer parte</a>
              </div>
              <div class="hero-highlights" style="margin-top: 20px; display: flex; gap: 12px; flex-wrap: wrap;">
                <span class="pill pink">Agendas cheias</span>
                <span class="pill">Pagamentos semanais</span>
                <span class="pill">Suporte dedicado</span>
              </div>
            </div>
            <div class="card-login" id="login-card">
              <h3>Acesse sua conta</h3>
              <form id="login-form" autocomplete="on" novalidate>
                <div class="field">
                  <label for="email">E-mail</label>
                  <input type="email" id="login-email" name="email" required autocomplete="email" />
                </div>
                <div class="field">
                  <label for="senha">Senha</label>
                  <input type="password" id="login-password" name="senha" required autocomplete="current-password" />
                </div>
                <button type="submit" class="btn-modern btn-pink" id="login-submit" style="width: 100%">
                  Entrar na plataforma
                </button>
                <p class="muted">Esqueceu a senha? Entre em contato com nosso suporte.</p>
              </form>
              <p class="login-feedback" id="login-feedback" role="status" aria-live="polite"></p>
            </div>
          </div>
        </div>
      </section>

      <section class="portal" id="professional-portal" aria-live="polite">
        <div class="container">
          <div class="portal-header">
            <div>
              <span class="chip">Área da profissional</span>
              <h2 id="portal-greeting">Bem-vinda de volta</h2>
              <p class="portal-meta" id="portal-subhead">
                Visualize suas solicitações de agendamento e organize seus atendimentos.
              </p>
              <p class="portal-meta" id="portal-meta"></p>
            </div>
            <div class="portal-actions">
              <button type="button" class="btn-modern btn-outline" id="refresh-requests">
                Atualizar lista
              </button>
              <button type="button" class="btn-modern btn-white" id="logout-button">Sair</button>
            </div>
          </div>
          <div class="portal-status" id="portal-status" role="status" aria-live="polite"></div>
          <div class="summary-grid" id="request-summary"></div>
          <div class="requests-wrapper">
            <div class="requests-list" id="requests-list" aria-live="polite"></div>
            <div class="request-empty is-hidden" id="requests-empty">
              Nenhuma solicitação por aqui ainda. Assim que uma cliente pedir um atendimento, você verá os detalhes nesta área.
            </div>
          </div>
        </div>
      </section>

      <section class="beneficios">
        <div class="container">
          <span class="chip">Por que ser uma profissional NailNow</span>
          <h2>Autonomia para atender com tranquilidade</h2>
          <div class="cards">
            <div class="card">
              <div class="icon">💼</div>
              <h3>Pedidos recorrentes</h3>
              <p>Agenda sua rotina com clientes fiéis e novas oportunidades toda semana.</p>
            </div>
            <div class="card">
              <div class="icon">🕒</div>
              <h3>Horários flexíveis</h3>
              <p>Defina sua disponibilidade e aceite apenas os atendimentos que fizerem sentido.</p>
            </div>
            <div class="card">
              <div class="icon">💳</div>
              <h3>Pagamentos garantidos</h3>
              <p>Receba via plataforma com segurança e acompanhe seus ganhos em tempo real.</p>
            </div>
            <div class="card">
              <div class="icon">🎯</div>
              <h3>Marketing constante</h3>
              <p>Conte com a NailNow para destacar seus serviços e atrair mais clientes.</p>
            </div>
          </div>
        </div>
      </section>

      <section class="flow">
        <div class="container">
          <span class="chip">Como funciona</span>
          <h2>Conectamos você com clientes em 4 passos</h2>
          <div class="flow-visual">
            <div class="flow-step">
              <img
                src="https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?auto=format&fit=crop&w=320&q=80"
                alt="Manicure sorrindo enquanto organiza seus materiais de trabalho"
              />
              <h3>Crie seu perfil</h3>
              <p>Cadastre-se, adicione fotos e conte sua história para encantar novas clientes.</p>
            </div>
            <div class="flow-arrow" aria-hidden="true">→</div>
            <div class="flow-step">
              <img
                src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=320&q=80"
                alt="Manicure conversando com uma cliente sobre agendamentos no celular"
              />
              <h3>Receba pedidos</h3>
              <p>Clientes verificadas encontram seus serviços e enviam pedidos recorrentes.</p>
            </div>
            <div class="flow-arrow" aria-hidden="true">→</div>
            <div class="flow-step">
              <img
                src="https://images.unsplash.com/photo-1522337660859-02fbefca4702?auto=format&fit=crop&w=320&q=80"
                alt="Profissional atendendo cliente com liberdade"
              />
              <h3>Atenda com liberdade</h3>
              <p>Escolha onde e quando atender: em domicílio, no estúdio ou em coworkings parceiros.</p>
            </div>
            <div class="flow-arrow" aria-hidden="true">→</div>
            <div class="flow-step">
              <img
                src="https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=320&q=80"
                alt="Profissional comemorando pagamentos recebidos"
              />
              <h3>Receba com segurança</h3>
              <p>Acompanhe repasses protegidos e amplie sua base de clientes com total suporte.</p>
            </div>
          </div>
        </div>
      </section>

      <section class="deps">
        <div class="container">
          <span class="chip">Elas já fazem parte</span>
          <h2>Histórias reais de profissionais</h2>
          <div class="dep-row">
            <div class="dep">
              <div class="person">
                <div class="avatar"></div>
                <div>
                  <strong>Bianca, Porto Alegre</strong>
                  <div class="stars">★★★★★</div>
                </div>
              </div>
              <p>
                “Com a NailNow consigo manter minha agenda cheia e ainda ter tempo para os cursos de
                aperfeiçoamento. Os clientes amam o atendimento!”
              </p>
            </div>
            <div class="dep">
              <div class="person">
                <div class="avatar"></div>
                <div>
                  <strong>Mariana, São Paulo</strong>
                  <div class="stars">★★★★★</div>
                </div>
              </div>
              <p>
                “O suporte é incrível. Sempre que preciso atualizar portfólio ou tirar dúvidas o time
                está pronto para ajudar.”
              </p>
            </div>
            <div class="dep">
              <div class="person">
                <div class="avatar"></div>
                <div>
                  <strong>Camila, Rio de Janeiro</strong>
                  <div class="stars">★★★★★</div>
                </div>
              </div>
              <p>
                “Recebo meus pagamentos em dia e com transparência. Isso me dá confiança para crescer
                dentro da plataforma.”
              </p>
            </div>
          </div>
        </div>
      </section>

      <section class="trust">
        <div class="container">
          <span class="chip">Transparência e confiança</span>
          <h2>Segurança em cada etapa do atendimento</h2>
          <div class="trust-grid">
            <div class="trust-item">
              <h4>Segurança verificada</h4>
              <p>Clientes verificados e avaliações públicas em todos os atendimentos.</p>
            </div>
            <div class="trust-item">
              <h4>Pagamentos garantidos</h4>
              <p>Antecipe valores, acompanhe repasses e tenha relatórios completos.</p>
            </div>
            <div class="trust-item">
              <h4>Política justa</h4>
              <p>Contrato transparente, proteção em casos de cancelamento e suporte jurídico.</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <div class="footer-column footer-column--brand">
          <h2 class="footer-logo">NailNow</h2>
          <p>
            Beleza na sua agenda com profissionais selecionadas, atendimento onde você estiver e
            suporte humanizado.
          </p>
        </div>
        <div class="footer-column footer-links" aria-label="Links úteis">
          <h3>FAQ</h3>
          <a href="../faq.html">Perguntas frequentes</a>
          <a href="../como-funciona.html">Como funciona</a>
          <a href="../agendamentos.html">Agendamentos</a>
        </div>
        <div class="footer-column footer-links" aria-label="Contato e suporte">
          <h3>Contato &amp; suporte</h3>
          <a href="mailto:contato@nailnow.com">contato@nailnow.com</a>
        </div>
        <div class="footer-column footer-links" aria-label="Termos e políticas">
          <h3>Termos &amp; políticas</h3>
          <a href="#">Termos de uso</a>
          <a href="#">Política de privacidade</a>
          <a href="#">Cookies e preferências</a>
        </div>
      </div>
      <p class="footer-copy">© NailNow 2025. Todos os direitos reservados.</p>
    </footer>

    <nav class="bottom-nav" aria-label="Navegação inferior fixa">
      <a href="/" class="bottom-nav__link">Home</a>
      <a href="../servicos.html" class="bottom-nav__link">Buscar</a>
      <a href="../cliente/index.html" class="bottom-nav__link">Agendamentos</a>
      <a href="../cliente/" class="bottom-nav__link">Perfil</a>
    </nav>
  </body>
</html>
