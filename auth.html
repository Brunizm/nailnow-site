<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auth - NailNow</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="mobile.css" />
  </head>
  <body>
    <main class="card">
      <h2>Criar conta</h2>
      <input id="nome" placeholder="Nome" required />
      <input id="email" placeholder="E-mail" required />
      <input id="senha" placeholder="Senha" type="password" required />
      <div class="radio-group">
        <label>
          <input type="radio" name="tipo" value="cliente" checked />
          Cliente
        </label>
        <label>
          <input type="radio" name="tipo" value="profissional" />
          Profissional
        </label>
      </div>
      <button id="botaoCadastrar">Cadastrar</button>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCFLccZ3khmT8uqoye6n6kfbqMFRzeXybE",
        authDomain: "nailnow-7546c.firebaseapp.com",
        projectId: "nailnow-7546c",
        storageBucket: "nailnow-7546c.firebasestorage.app",
        messagingSenderId: "413820353687",
        appId: "1:413820353687:web:ad92108dbea59f7749fdd2",
        measurementId: "G-2YEGPEG0E1",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      async function registrarUsuario(nome, email, senha, role) {
        try {
          const senhaLimpa = (senha ?? "").trim();
          const cred = await createUserWithEmailAndPassword(auth, email, senhaLimpa);
          const uid = cred.user.uid;

          await setDoc(doc(db, role, uid), {
            authUid: uid,
            name: nome,
            email,
            senha: senhaLimpa,
            senhaAtualizadaEm: serverTimestamp(),
            role,
            createdAt: serverTimestamp(),
            status: "ativo",
          });

          alert("UsuÃ¡rio criado com sucesso!");
        } catch (err) {
          alert("Erro: " + err.message);
        }
      }

      document
        .getElementById("botaoCadastrar")
        .addEventListener("click", async () => {
          const nome = document.getElementById("nome").value;
          const email = document.getElementById("email").value;
          const senha = document.getElementById("senha").value;
          const role = document.querySelector('input[name="tipo"]:checked').value;
          await registrarUsuario(nome, email, senha, role);
        });
    </script>
  </body>
</html>
